---
layout: distill
title: From Data to Simulation ‚Äî A Walkthrough of a Patient-Specific Cardiovascular Model
description: A step-by-step overview of how imaging data becomes a working simulation model of the human cardiovascular system.
tags: cardiovascular modeling, simulation, mesh generation, biomechanics, medical imaging
giscus_comments: false
date: 2025-11-02
featured: true

authors:
  - name: Numi Sveinsson Cepero
    url: "https://numisveinsson.com"
    affiliations:
      name: Oden Institute for Computational Engineering and Sciences, UT Austin

toc:
  - name: From Scan to Segmentation
  - name: Building the Geometry
  - name: Mesh Generation
  - name: Boundary Conditions and Flow Setup
  - name: Running the Simulation
  - name: Post-Processing and Visualization
  - name: Common Challenges and Design Decisions
  - name: Looking Ahead
---

## Introduction

One of the most fascinating parts of computational biomechanics is seeing how a **CT scan** eventually becomes a **living, pulsating simulation** of blood flow.  
In this post, I‚Äôll walk through that process step by step ‚Äî from the raw data to a simulation-ready cardiovascular model ‚Äî using examples from recent work in **patient-specific vascular modeling**.

The goal isn‚Äôt just to describe each step, but to show how design decisions at each stage affect the realism, stability, and reproducibility of the final model.

---

## From Scan to Segmentation

It all starts with **medical imaging** ‚Äî typically **CT angiography (CCTA)** or **MR angiography (MRA)**.  
After anonymization, the first computational step is **segmentation**: extracting the vessel lumen and cardiac chambers from 3D image volumes.

I use a combination of **AI-based segmentation (SeqSeg)** and manual refinement for difficult regions.  
Even small errors in segmentation can have a large downstream effect, so quality checks here are essential ‚Äî especially around bifurcations or small side branches.

> *Tip:* Always keep the raw segmentation masks archived with metadata (scanner type, resolution, contrast phase). You‚Äôll need them later for reproducibility.

üì∑ **Figure 1:** Example of segmentation output from CT angiography  
*Left: original scan slice; Right: segmented lumen mask.*

---

## Building the Geometry

Once segmentation is done, the next step is turning that mask into a **smooth 3D surface**.  
We use tools like **3D Slicer**, **SimVascular**, or custom scripts for surface extraction and cleaning (removing small disconnected pieces, closing holes, and smoothing).

The trick is to balance **geometric fidelity** with **numerical stability** ‚Äî a perfectly detailed surface can lead to meshing problems later.  
At this stage, I often generate both a **high-resolution reference model** and a **simplified simulation model**.

üì∑ **Figure 2:** Surface reconstruction from segmented data  
*Smooth vascular surface extracted from mask, showing main coronary branches.*

---

## Mesh Generation

This is where the model starts to feel ‚Äúreal.‚Äù  
The mesh defines how equations are solved within the geometry ‚Äî too coarse and you lose accuracy, too fine and simulations become impractical.

For vascular simulations, I usually generate **unstructured tetrahedral meshes** using **TetGen** or **VMTK**, and then refine near vessel walls or bifurcations.  
Automating this step was a major motivation for developing **MeshGrow**, which builds a unified mesh of both the heart and vessels directly from segmentation data.

Key mesh quality checks:
- Element aspect ratio  
- Wall layer resolution (for boundary-layer modeling)  
- Connectivity and smoothness across junctions  

üì∑ **Figure 3:** Example of simulation-ready mesh  
*Finite element mesh of the coronary arteries with refined wall layers.*

---

## Boundary Conditions and Flow Setup

Once the mesh is ready, we define **inlet and outlet boundary conditions** ‚Äî the part that turns geometry into physiology.  
For coronary models, I often use:
- **Inlet:** measured or literature-based flow waveform  
- **Outlets:** lumped parameter (Windkessel) models  
- **Walls:** either rigid or deformable, depending on the study  

Getting these right is crucial for physiological realism.  
I typically use Python scripts to apply these automatically based on metadata, ensuring consistency across simulations.

---

## Running the Simulation

With everything in place, the model is ready to simulate.  
We solve the **Navier‚ÄìStokes equations** for incompressible flow, typically using **OpenFOAM**, **SimVascular**, or in-house solvers.

Depending on model size, simulations can take from a few hours to several days.  
This is where computing infrastructure (e.g., UT‚Äôs **Frontera** or **Stampede3**) really matters ‚Äî running multiple patients or parameter sweeps requires HPC access.

---

## Post-Processing and Visualization

After the solver finishes, we can visualize flow fields, pressure gradients, and wall shear stress distributions.  
These outputs are usually saved in **VTK** format for easy visualization in **ParaView** or custom dashboards.

A good post-processing pipeline should include:
- Streamline plots and velocity profiles  
- Pressure‚Äìflow relationships  
- Exported summary statistics (mean WSS, flow split ratios)  

These results often feed into further studies ‚Äî for example, comparing pre- and post-intervention hemodynamics or training ML models on flow features.

---

## Common Challenges and Design Decisions

Every dataset is different, and the modeling choices often depend on:
- **Image quality:** noisy or low-contrast regions require extra segmentation effort  
- **Branch truncation:** deciding where to cut off distal vessels  
- **Mesh smoothness vs. resolution:** balancing fidelity and stability  
- **Boundary conditions:** limited patient-specific data means assumptions must be stated clearly  

Documenting each choice (and its reasoning) makes your results far easier to reproduce ‚Äî and it‚Äôs a good habit when preparing publications.

---

## Looking Ahead

As vascular modeling becomes more data-driven, the boundary between **data processing** and **simulation** is fading.  
AI tools now assist with segmentation, meshing, and even automatic boundary condition assignment.  

But the foundation remains the same: **traceable, structured data** and transparent modeling workflows.

In future posts, I‚Äôll dive deeper into:
- Automating boundary condition assignment  
- Linking simulations with the vascular model repository  
- Using AI to predict flow distributions directly from geometry  

---

### Simple workflow overview

```text
[CT/MR Scan]
       ‚Üì
[Segmentation (SeqSeg)]
       ‚Üì
[Surface Model]
       ‚Üì
[Mesh Generation (MeshGrow)]
       ‚Üì
[Boundary Conditions]
       ‚Üì
[CFD Simulation]
       ‚Üì
[Visualization & Analysis]
